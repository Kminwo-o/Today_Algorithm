# HTTP (Hyper Text Transfer Protocol)

## 모든 것이 HTTP
- 요즘은 Image, Json 등 거의 모든 형태를 HTTP 메세지를 통해 전송한다.

### HTTP의 버전별 차이
    - 0.9 (1991년) : GET 메서드만 지원, HTTP 헤더 X
    - 1.0 (1996년) : 메서드, 헤더 추가
    - 1.1 (1997년) : 가장 많이 사용, 우리가 가장 많이 사용하는 버전, 대부분의 기능이 들어있음.
    - 2 (2015년) : 성능 개선 ex) SSE
    - 3 (진행중) : TCP 대신에 UDP를 사용, 성능개선

### 기반 프로토콜 
    - tcp : http 1.1. http 2
    - udp : http 3
---
## 클라이언트와 서버 구조

- Request, Response를 분리하는것이 중요하다.
- 클라이언트는 서버에 요청을 보내고, 응답을 대기
- 클라이언트는 UI, 사용성에 집중하고 서버는 로직에 집중해 독립적으로 발전할 수 있다.

## Stateful, Stateless

- 서버가 클라이언트의 상태를 보존하지 않는 것을 의미한다.

### statedful 예시

    ```plain
    고객 : 노트북 얼마인가요?
    점원 : 100만원 입니다. (노트북 상태 유지)

    고객 : 2개 구매할게요
    점원 : 200만원 입니다. 카드와 현금 중 어떤걸로 구매하시겠어요? (노트북, 2개 상태 유지)

    고객 : 카드로 할게요
    점원 : 네, 200만원 카드 결제 완료되었습니다. (노트북, 2개, 신용카드 상태 유지)
    ```
### stateless 예시
    ```plain
    고객 : 이 노트북 얼마인가요?
    점원 : 100만원입니다.

    고객 : 노트북 2개 구매할게요
    점원 : 노트북 2개는 200만원입니다. 신용카드, 현금 중 어떻게 구매하시겠어요?

    고객 : 노트북 2개 신용카드로 구매할게요.
    점원 : 200만원 카드 결제 완료되었습니다.
    ```

- 두 예시의 차이가 없다고 느낄 수도 있으나, stateful의 경우 중간에 점원이 바뀌면 무엇을 구매할 것인지, 얼마를 결제해야하는지 알 수 없다. 그러나 stateless의 경우 중간에 점원이 바뀌더라도 문제 (에러) 없이 진행할 수 있다.
- 무상태는 응답 서버를 쉽게 바꿀 수 있고, 갑자기 고객이 증가하더라도 서버를 대거 투입할 수 있다.
- 스케일 아웃을 통해 확장하기 매우 용이하다.
- 모든 것을 무상태로 설계 할 수 없을 수도 있다.
    - 단순 서비스 소개의 경우 무상태여도 괜찮다. 그러나 로그인 같은 경우 로그인 상태를 서버에 유지해야한다. 이런 경우 일반적으로는 쿠키나 세션을 사용해서 상태를 유지하지만 이 때, 상태 유지는 최소한만 사용해야한다.

---

## 비연결성
- 클라이언트가 여럿 있을 때, 연결을 유지하는 경우 클라이언트 3과 요청 및 응답을 하는 경우에도 1, 2와 연결을 하고 있어야해서 서버 비용이 낭비된다. 요청, 응답 이후 바로 연결을 끊게 되면 서버 유지 자원을 최소한으로 줄일 수 있다.
- HTTP는 기본적으로 연결을 유지하지 않는 모델이다. 비연결적으로 서버를 운영함으로써 자원을 효율적으로 사용할 수 있다.

### 한계
    - 요청 및 응답이 필요할 때마다 TCP/IP연결을 새로 해야한다. (3way handshake가 매번 발생)
    - 응답 시 HTML 뿐 아니라 js, css, 이미지 등 많은 자원이 함께 다운로드된다.
    - HTTP 지속 연결 (Persistent Connections)로 문제해결이 가능하다.
        - 연결 후, HTML, JS, 이미지 등을 모두 받고 연결을 종료함
    - HTTP 2와 HTTP 3에서는 더욱 개선되었다. 
---
## HTTP 메시지
- HTTP 메세지에 모든 것을 전송
- 공백은 무조건 필요하다.
### HTTP 메세지 구조
- start-line
    - HTTP 메소드, 버전 등
- header
    - HOST, Content-Type 등
- empty line (CRLF)
- message body
    - data

### 시작 라인
- request
    ```
    - request-line / status-line 으로 이루어져있다.
    - http 메서드, 요청 대상, 버전이 들어간다.
    - GET, POST, PUT, DELETE 등이 있다.
    ```
- response
    ```
    - http 버전
    - http 상태코드 : 2xx (성공), 3xx, 4xx (클라이언트 오류), 5xx (서버 오류)
    - error message :
    ```

### 헤더
- field-name은 대소문자 구분이 없다.
- 필요한 모든 부가정보가 들어간다. body가 json인지 html인지, 어떤 언어인지

### 바디
- 실제 전송할 데이터
- byte로 표현할 수 있는 모든 데이터 전송 가능